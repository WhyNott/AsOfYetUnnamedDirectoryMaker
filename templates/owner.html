<!DOCTYPE html>
<html>
<head>
    <title>Owner Panel - Directory Service</title>
    <link rel="stylesheet" href="/static/css/owner.css">
    <link rel="stylesheet" href="https://latex.vercel.app/style.css">
</head>
<body>
    <div class="container">
        <h1>Owner Panel - {{.Directory.Name}}</h1>
        <div>
            <p>Welcome, {{.UserEmail}}</p>
            <p>Managing directory: <strong>{{.Directory.ID}}</strong>
            {{if .Directory.Description}} ({{.Directory.Description}}){{end}}
            </p>
        </div>
        
        {{if .ImportSuccess}}
        <div>
            <strong>âœ… Import Successful!</strong> The Google Sheet has been successfully imported into the directory.
            <a href="{{.ViewDirectoryURL}}">View Directory</a>
        </div>
        {{end}}
        
        <!-- Moderator Management Section -->
        <div>
            <h2>Moderator Management</h2>
            
            <div>
                <button id="showModeratorForm">Add Moderator</button>
                <button id="viewModerators">View Moderators</button>
            </div>
            
            <!-- Add Moderator Form -->
            <div id="moderatorForm" style="display: none;">
                <h3>Appoint New Moderator</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="moderatorEmail" placeholder="moderator@example.com">
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="moderatorUsername" placeholder="username">
                </div>
                <div class="form-group">
                    <label>Auth Provider:</label>
                    <select id="authProvider">
                        <option value="google">Google</option>
                        <option value="twitter">Twitter/X</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" id="canEdit" checked> Can Edit</label><br>
                    <label><input type="checkbox" id="canApprove"> Can Approve Changes</label><br>
                    <label><input type="checkbox" id="requiresApproval" checked> Requires Approval</label>
                </div>
                <div class="form-group">
                    <label>Row Access:</label>
                    <div>
                        <label><input type="radio" name="rowAccessType" value="all" checked> All Rows</label><br>
                        <label><input type="radio" name="rowAccessType" value="specific"> Specific Rows</label>
                    </div>
                    <div id="specificRowsSection" style="display: none;">
                        <div>Select rows to allow access:</div>
                        <div id="rowSelectionList">Loading rows...</div>
                    </div>
                </div>
                <div>
                    <button id="appointModerator">Appoint Moderator</button>
                    <button id="cancelModerator">Cancel</button>
                </div>
            </div>
            
            <!-- Moderators List -->
            <div id="moderatorsList" style="display: none;">
                <h3>Current Moderators</h3>
                <div id="moderatorsContent">Loading...</div>
            </div>
        </div>
        
        <!-- Moderation Rules Section -->
        <div>
            <h2>Moderation Rules Configuration</h2>
            <p>Configure which rows require moderator approval for changes:</p>
            
            <div>
                <button id="showModerationRules">Configure Moderation Rules</button>
                <button id="viewCurrentRules">View Current Rules</button>
            </div>
            
            <!-- Moderation Rules Form -->
            <div id="moderationRulesForm" style="display: none;">
                <h3>Set Up Moderation Rules</h3>
                <p style="font-size: 0.9em; color: #666;">
                    Define filter-based rules to specify which rows require moderator approval for edits, additions, or deletions.
                </p>
                
                <div class="form-group">
                    <label>Rule Name:</label>
                    <input type="text" id="ruleName" placeholder="e.g., High-value items">
                </div>
                
                <div class="form-group">
                    <label>Column to Filter:</label>
                    <select id="filterColumn">
                        <option value="">Select a column...</option>
                        <!-- Will be populated dynamically -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Filter Type:</label>
                    <select id="filterType">
                        <option value="categories">Category Match</option>
                        <option value="tags">Tag Match</option>
                        <option value="locations">Location Match</option>
                        <option value="numeric_range">Numeric Range</option>
                    </select>
                </div>
                
                <!-- Category/Tag/Location Filter Options -->
                <div id="textFilterOptions" class="filter-options">
                    <label>Values (comma-separated):</label>
                    <input type="text" id="filterValues" placeholder="e.g., Premium, Enterprise, VIP">
                </div>
                
                <!-- Numeric Range Filter Options -->
                <div id="numericFilterOptions" class="filter-options" style="display: none;">
                    <label>Range Type:</label>
                    <select id="rangeType">
                        <option value="above">Above</option>
                        <option value="below">Below</option>
                        <option value="between">Between</option>
                    </select>
                    <div id="thresholdInput">
                        <label>Threshold:</label>
                        <input type="number" id="threshold" placeholder="100">
                    </div>
                    <div id="rangeInputs" style="display: none;">
                        <label>Min:</label>
                        <input type="number" id="minValue" placeholder="0">
                        <label>Max:</label>
                        <input type="number" id="maxValue" placeholder="1000">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Operations Requiring Approval:</label>
                    <div>
                        <label><input type="checkbox" id="requireEdit" checked> Edit</label>
                        <label><input type="checkbox" id="requireAdd" checked> Add</label>
                        <label><input type="checkbox" id="requireDelete" checked> Delete</label>
                    </div>
                </div>
                
                <div>
                    <button id="addModerationRule">Add Rule</button>
                    <button id="cancelModerationRule">Cancel</button>
                </div>
            </div>
            
            <!-- Current Moderation Rules -->
            <div id="currentRules" style="display: none;">
                <h3>Current Moderation Rules</h3>
                <div id="rulesContent">Loading...</div>
            </div>
        </div>
        
        <form action="{{.ImportURL}}" method="POST" id="importForm">
            <h2>Import Google Sheet</h2>
            <p>Enter the URL of your Google Sheet:</p>
            <input type="url" name="sheet_url" id="sheet_url" placeholder="https://docs.google.com/spreadsheets/d/..." required>
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <br><br>
            <button type="button" id="previewBtn">Preview Sheet</button>
            <button type="submit" id="importBtn" style="display:none;">Import Sheet</button>
        </form>
        
        <div id="previewSection" style="display:none;">
            <h3>Sheet Preview</h3>
            <div id="previewContent"></div>
            <div>
                <button type="button" id="confirmImport">Confirm Import</button>
                <button type="button" id="cancelPreview">Cancel</button>
            </div>
        </div>
        
        <hr>
        <p><a href="{{.ViewDirectoryURL}}">View Directory</a> | <a href="/logout">Logout</a></p>
    </div>
    
    <script>
        // Global template variables
        window.ownerConfig = {
            csrfToken: '{{.CSRFToken}}',
            previewURL: '{{.PreviewURL}}',
            importURL: '{{.ImportURL}}',
            ownerURL: '{{.AdminURL}}',
            directoryId: '{{.Directory.ID}}'
        };
    </script>
    <script src="/static/js/owner.js"></script>
</body>
</html>