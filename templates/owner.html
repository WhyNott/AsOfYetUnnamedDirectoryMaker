<!DOCTYPE html>
<html>
<head>
    <title>Owner Panel - Directory Service</title>
    <link rel="stylesheet" href="/static/css/owner.css">
    <link rel="stylesheet" href="https://latex.vercel.app/style.css">
</head>
<body>
    <div class="container">
        <h1>Owner Panel - {{.Directory.Name}}</h1>
        <div>
            <p>Welcome, {{.UserEmail}}</p>
            <p>Managing directory: <strong>{{.Directory.ID}}</strong>
            {{if .Directory.Description}} ({{.Directory.Description}}){{end}}
            </p>
        </div>
        
        {{if .ImportSuccess}}
        <div>
            <strong>âœ… Import Successful!</strong> The Google Sheet has been successfully imported into the directory.
            <a href="{{.ViewDirectoryURL}}">View Directory</a>
        </div>
        {{end}}
        
        <!-- Moderator Management Section -->
        <div>
            <h2>Moderator Management</h2>
            
            <div>
                <button id="showModeratorForm">Add Moderator</button>
                <button id="viewModerators">View Moderators</button>
            </div>
            
            <!-- Add Moderator Form -->
            <div id="moderatorForm" style="display: none;">
                <h3>Appoint New Moderator</h3>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="moderatorEmail" placeholder="moderator@example.com">
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="moderatorUsername" placeholder="username">
                </div>
                <div class="form-group">
                    <label>Auth Provider:</label>
                    <select id="authProvider">
                        <option value="google">Google</option>
                        <option value="twitter">Twitter/X</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" id="canEdit" checked> Can Edit</label><br>
                    <label><input type="checkbox" id="canApprove"> Can Approve Changes</label><br>
                    <label><input type="checkbox" id="requiresApproval" checked> Requires Approval</label>
                </div>
                <div class="form-group">
                    <label>Row Access:</label>
                    <div>
                        <label><input type="radio" name="rowAccessType" value="all" checked> All Rows</label><br>
                        <label><input type="radio" name="rowAccessType" value="specific"> Specific Rows</label>
                    </div>
                    <div id="specificRowsSection" style="display: none;">
                        <div>Select rows to allow access:</div>
                        <div id="rowSelectionList">Loading rows...</div>
                    </div>
                </div>
                <div>
                    <button id="appointModerator">Appoint Moderator</button>
                    <button id="cancelModerator">Cancel</button>
                </div>
            </div>
            
            <!-- Moderators List -->
            <div id="moderatorsList" style="display: none;">
                <h3>Current Moderators</h3>
                <div id="moderatorsContent">Loading...</div>
            </div>
        </div>
        
        <form action="{{.ImportURL}}" method="POST" id="importForm">
            <h2>Import Google Sheet</h2>
            <p>Enter the URL of your Google Sheet:</p>
            <input type="url" name="sheet_url" id="sheet_url" placeholder="https://docs.google.com/spreadsheets/d/..." required>
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <br><br>
            <button type="button" id="previewBtn">Preview Sheet</button>
            <button type="submit" id="importBtn" style="display:none;">Import Sheet</button>
        </form>
        
        <div id="previewSection" style="display:none;">
            <h3>Sheet Preview</h3>
            <div id="previewContent"></div>
            <div>
                <button type="button" id="confirmImport">Confirm Import</button>
                <button type="button" id="cancelPreview">Cancel</button>
            </div>
        </div>
        
        <hr>
        <p><a href="{{.ViewDirectoryURL}}">View Directory</a> | <a href="/logout">Logout</a></p>
    </div>
    
    <script>
        // Global template variables
        window.adminConfig = {
            csrfToken: '{{.CSRFToken}}',
            previewURL: '{{.PreviewURL}}',
            importURL: '{{.ImportURL}}',
            adminURL: '{{.AdminURL}}',
            directoryId: '{{.Directory.ID}}'
        };
    </script>
    <script src="/static/js/owner.js"></script>
</body>
</html>